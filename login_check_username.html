<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>login_check_username</title>
</head>
<body>
<div align="center">
    <h3>用户登录</h3>
    <form action="./login_check_username.php" method="post">
        <p>账号：<input type="text" name="name" id="name"></p>
        <span id="warning" style="color: red"></span>
        <p>密码：<input type="password" name="password" id="password"></p>
        <p><input type="submit" id="submit" value="提交"></p>
        <h2 id="tips"></h2>
    </form>
</div>

<script>
    /*
    * 用Ajax检测用户名是否存在
    *1.如果用户名已经存在，则表示是注册用户。
    *2.如果用户名不存在，则表示是新用户，提醒用户先注册再登陆，并把登陆按钮禁用。
    *3整个过程都在当前页面完成，无刷新无跳转。
    *
    * */
    var user = document.querySelector('#name'),
        submit = document.querySelector('#submit');
    user.onblur = function () { //当用户离开当前文本框时进行验证
        //1.创建Ajax对象
        var xhr = new XMLHttpRequest();
        //2.创建请求事件的监听
        xhr.onreadystatechange = function () {
            if(this.readyState === 4 && this.status === 200){
                if(this.responseText == 0){ //当用户不存在
                    document.querySelector('#warning').innerHTML = '新用户，请先注册再登录~~';
                    submit.disabled = true;
                }
            }
        };
        //3.初始化一个url请求
        var username = user.value;
        var password = document.querySelector('#password').value;
        var data = 'name=' + username ; //生成post请求数据
//        var data = 'name=' + username + '&password=' + password;
        var url = 'login_check_username.php';
        xhr.open('post',url, true);
        //4.设置请求头
        xhr.setRequestHeader('content-type', 'application/x-www-form-urlencoded');
        //5.发送url请求，需要传入参数
        xhr.send(data);
    };

    submit.onclick = function () {
        var tips = document.querySelector('#tips');
        tips.innerHTML = '验证通过，正在跳转中...';
        return false;
    }



</script>
</body>
</html>